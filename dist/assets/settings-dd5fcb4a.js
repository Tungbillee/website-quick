import{b as Q}from"./route-block-83d24a4e.js";import{_ as W,r as X,g as K,o as c,c as l,a as t,t as d,h as u,d as v,b as r,n as U,F as J,e as Z,i as tt,f as et,p as st,j as it,k as nt}from"./index-a44896c8.js";const F={data(){return{type_manage:"goi",type_transaction:"payment",dateRange:"",dataPaymentHistory:[],show_history_action:!1,user:{},isConfirmDeleteDevice:!1,pagination:{current_page:1,per_page:25,total:0,total_pages:0,loading:!1},dateRangeHistory:""}},watch:{type_manage(n){n==="giaodich"&&this.$nextTick(()=>{setTimeout(()=>{this.openDateRangePicker()},500)}),n==="history"&&this.$nextTick(()=>{setTimeout(()=>{this.openDateRangePickerHistory()},500)})},type_transaction(n){this.dataPaymentHistory=[],this.pagination.current_page=1,this.getPaymentHistory()},dateRange(n){this.dataPaymentHistory=[],this.pagination.current_page=1,this.getPaymentHistory()}},created(){this.getUser(),this.getPaymentHistory()},methods:{img(n){return"images/admin-panel/"+n},clickpageAccount(n){if(this[n]=!this[n],this[n]){const a=_=>{_.target.closest(".popup-class")||(this[n]=!1,window.removeEventListener("click",a))};window.addEventListener("click",a)}},goToBuyPoint(){window.open("https://www.facebook.com/mongkytruyen","_blank")},getColorByPercentage(n,a){const _=n??0,s=(_-(a??0))/_*100;return s>50?"text-green":s>30?"text-yellow":"text-red"},confirmDeleteDevice(){this.isConfirmDeleteDevice=!0},async deleteDevice(){(await this.api({path:"/web/user/delete-device",method:"POST"})).success&&(this.isConfirmDeleteDevice=!1,this.getUser())},goToBuyPackage(){this.$router.push("/buy-pankage")},goToBuySubtitle(){this.$router.push("/buy-subtitle")},goToBuyVoice(){this.$router.push("/buy-voice")},loadMorePayment(n){n&&!this.pagination.loading&&this.pagination.current_page<this.pagination.total_pages&&(this.pagination.current_page+=1,this.getPaymentHistory())},async getPaymentHistory(){if(this.pagination.loading)return;this.pagination.loading=!0;let n=await this.api({path:"/web/user/get-payment",params:{date_range:this.dateRange,type:this.type_transaction,page:this.pagination.current_page,limit:this.pagination.per_page}});n.success&&(this.dataPaymentHistory=[...this.dataPaymentHistory,...n.payment_history],this.pagination.total=n.pagination.total,this.pagination.total_pages=n.pagination.total_pages,this.pagination.loading=!1)},calculateDeviceRefreshTime(n){if(!n)return"0 ngày";const a=new Date(n),_=new Date(a.setMonth(a.getMonth()+1)),h=new Date,e=_.getTime()-h.getTime();return e<=0?"0 ngày":`${Math.ceil(e/(1e3*60*60*24))} ngày nữa`},async getUser(n=3){try{let a=await this.api({path:"/web/user/get-info"});if(a.success)this.user=a.data_user;else throw new Error("API request failed")}catch(a){if(console.error("Error fetching user info:",a),n>0)return await new Promise(_=>setTimeout(_,1e3)),this.getUser(n-1);console.error("Max retry attempts reached")}},formatnumber(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},getPackageIcon(n){const a={Normal:"icon_plus.svg",Pro:"icon_Pro.svg",Advance:"icon_Advance.svg"};return this.img(a[n]||"default_icon.svg")},formatExpiryDate(n){return moment(n).format("HH:mm - DD/MM/YYYY ")},calculatePercentageWidth(n,a){const _=n??0,h=a??0;if(_===0)return"0%";const s=(_-h)/_*100;return`${Math.min(100,Math.max(0,s))}%`},calculateRemainingMinutes(n,a){const e=(n??0)-(a??0);return this.formatnumber(e)},formatExpiryDateMonth(n){if(!n)return"0 ngày";const a=new Date,h=new Date(n).getTime()-a.getTime();if(h<=0)return"0 ngày";const e=Math.floor(h/(1e3*60*60*24)),s=Math.floor(h%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(e/30),m=e%30;return g>0?m===0?`${g} tháng`:m===1?`${g} tháng 1 ngày`:`${g} tháng ${m} ngày`:e>0?e===1?"1 ngày":`${e} ngày`:s===1?"1 giờ":`${s} giờ`},openDateRangePicker(){$('input[name="datetimes_payment"]').daterangepicker({ranges:{"Hôm nay":[moment(),moment()],"Hôm qua":[moment().subtract(1,"days"),moment().subtract(1,"days")],"7 ngày qua":[moment().subtract(6,"days"),moment()],"30 ngày qua":[moment().subtract(29,"days"),moment()],"Tháng này":[moment().startOf("month"),moment().endOf("month")],"Tháng trước":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:!0,startDate:"27/10/2024",endDate:"02/11/2024",locale:{format:"DD/MM/YYYY"}},(n,a,_)=>{this.dateRange=n.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY")})},openDateRangePickerHistory(){$('input[name="datetimes_history"]').daterangepicker({ranges:{"Hôm nay":[moment(),moment()],"Hôm qua":[moment().subtract(1,"days"),moment().subtract(1,"days")],"7 ngày qua":[moment().subtract(6,"days"),moment()],"30 ngày qua":[moment().subtract(29,"days"),moment()],"Tháng này":[moment().startOf("month"),moment().endOf("month")],"Tháng trước":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:!0,startDate:"27/10/2024",endDate:"02/11/2024",locale:{format:"DD/MM/YYYY"}},(n,a,_)=>{this.dateRangeHistory=n.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY")})}}},o=n=>(st("data-v-a410a737"),n=n(),it(),n),at={class:"container-settings"},ot=o(()=>t("div",{class:"spaces"},null,-1)),ct={class:"contents"},lt={class:"info"},rt={class:"flex-bw-al"},dt={class:"flex-al gap-10"},_t=["src"],ht={class:"fw-600 fz-20 text-long1"},ut={class:"flex-al gap-6 fz-16"},gt={class:"text-green"},mt={class:"flex-al gap-3"},vt=["src"],yt=o(()=>t("div",{class:"text-yellow fw-600"},"Point",-1)),pt={class:"flex-bw-al mgt-15"},ft={class:"flex-al gap-3"},xt=["src"],wt=o(()=>t("div",null,"Thiết bị đang kết nối:",-1)),bt={class:"text-yellow"},kt={class:"text-300 mgt-10"},Dt={class:"flex gap-10"},Pt=["src"],Tt=o(()=>t("div",null,"Mua gói",-1)),Mt={class:"table"},Ct={class:"header flex-al"},Yt=o(()=>t("div",null,"Quản lý gói cước",-1)),Ht=o(()=>t("div",null,"Quản lý giao dịch",-1)),Bt=o(()=>t("div",null,"Lịch sử hành động",-1)),Rt={key:0,class:"body"},St={class:"flex-al gap-5"},zt=["src"],At={class:"fz-24 fw-600"},Et={key:0,class:"expired flex-bw-al"},Ot={class:"flex-al gap-5"},It=["src"],Lt={class:"text-red fz-16 fw-500"},qt=o(()=>t("div",{class:"text-yellow fz-16 fw-600"},"Gia hạn ngay",-1)),Nt={class:"infos"},Vt=o(()=>t("div",{class:"title-info"},"Thời hạn gói cước",-1)),jt={class:"contens-info flex-al gap-3"},Gt=o(()=>t("div",{class:"text-300"},"-",-1)),Qt={class:"text-yellow"},Ut={class:"text-300"},Ft={class:"infos flex-bw-al"},Wt=o(()=>t("div",{class:"title-info"},"Số phút tách phụ đề",-1)),Xt={class:"flex-al contens-info gap-5"},Kt=o(()=>t("div",{class:"curso"},null,-1)),Jt={class:"loading"},Zt={class:"infos flex-bw-al"},$t=o(()=>t("div",{class:"title-info"},"Ký tự lồng tiếng",-1)),te={class:"flex-al contens-info gap-5"},ee=o(()=>t("div",{class:"curso"},null,-1)),se={class:"loading"},ie={key:1,class:"transaction"},ne={class:"config flex-bw-al"},ae={class:"flex select-transaction"},oe={class:"selects-type flex-al gap-3"},ce=["src"],le=o(()=>t("div",{class:"text-300"},[t("input",{type:"text",name:"datetimes_payment",class:"text-300"})],-1)),re=["src"],de={class:"body-transaction"},_e={class:"header-transaction flex-al"},he=o(()=>t("div",{class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},"Thời gian",-1)),ue=o(()=>t("div",{class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},"Giá trị giao dịch",-1)),ge={key:0,class:"titles-transaction",style:{"min-width":"250px"}},me={key:1,class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},ve={key:2,class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},ye=o(()=>t("div",{class:"titles-transaction",style:{"min-width":"150px"}},"Trạng thái",-1)),pe={class:"table-transaction"},fe={class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},xe={class:"titles-transaction flex-al gap-10",style:{"min-width":"250px",width:"100%"}},we={key:0,class:"text-red"},be={key:1,class:"text-green"},ke={class:"flex-al gap-5"},De=["src"],Pe=o(()=>t("div",{class:"text-yellow fw-600"},"Point",-1)),Te={key:0,class:"titles-transaction",style:{"min-width":"250px"}},Me={key:0},Ce={key:1},Ye={key:2},He={key:1,class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},Be={key:0,class:"flex-al text-300"},Re={key:1,class:"flex-al mgt-10 text-300"},Se={key:2,class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},ze={class:"titles-transaction",style:{"min-width":"150px"}},Ae={key:0,class:"text-green"},Ee={key:0,ref:"sentinel",class:"sentinel"},Oe={key:2,class:"transaction"},Ie={class:"header-history flex-bw-al"},Le={class:"selects-type flex-al gap-3"},qe=["src"],Ne=o(()=>t("div",{class:"text-300"},[t("input",{type:"text",name:"datetimes_history",class:"text-300"})],-1)),Ve=["src"],je=["src"],Ge=o(()=>t("div",null,[t("span",{class:"text-300"},"Trạng thái: "),nt(" Tất cả")],-1)),Qe=["src"],Ue={key:0,class:"select-action"},Fe=o(()=>t("div",{class:"items"},"Tất cả",-1)),We=o(()=>t("div",{class:"items"},"Thành công",-1)),Xe=o(()=>t("div",{class:"items"},"Thất bại",-1)),Ke=[Fe,We,Xe],Je=et('<div class="table-history" data-v-a410a737><div class="header-history flex-al" data-v-a410a737><div class="title-history" style="min-width:200px;" data-v-a410a737>Thời gian</div><div class="title-history" style="min-width:220px;width:50%;" data-v-a410a737>Video</div><div class="title-history" style="min-width:250px;width:50%;" data-v-a410a737>Chi tiết hành động</div><div class="title-history" style="min-width:150px;" data-v-a410a737>Trạng thái</div></div><div class="body-history" data-v-a410a737><div class="item-history flex-al" data-v-a410a737><div class="title-history" style="min-width:200px;" data-v-a410a737>12:05 - 22/10/2022</div><div class="title-history" style="min-width:220px;width:50%;" data-v-a410a737>Quickmagic_12324232</div><div class="title-history flex-al gap-5" style="min-width:250px;width:50%;" data-v-a410a737><div data-v-a410a737>12 ký tự <span class="text-300" data-v-a410a737>lồng tiếng</span></div><div class="text-300" data-v-a410a737>|</div><div data-v-a410a737>12 phút <span class="text-300" data-v-a410a737>phụ đề</span></div></div><div class="title-history" style="min-width:150px;" data-v-a410a737><div class="text-green" data-v-a410a737>Thành công</div></div></div></div></div>',1),Ze={key:0,class:"confirm-delete-device flex-al-jt"},$e={class:"confirm-delete-device-content flex-cl-al"},ts=["src"],es=o(()=>t("div",{class:"fw-600 fz-16"},"Xác nhận xoá thiết bị",-1)),ss=o(()=>t("div",{class:"text-300 mgt-10 text-al"},"Sau khi xoá thiết bị hiện tại, bạn có thể kết nối tài khoản QuickMagic với một thiết bị khác.",-1));function is(n,a,_,h,e,s){var y,p,f,x,w,b,k,D,P,T,M,C,Y,H,B,R,S,z,A,E,O,I,L,q,N,V,j,G;const g=X("Icon"),m=K("observe-visibility");return c(),l("div",at,[ot,t("div",ct,[t("div",lt,[t("div",rt,[t("div",dt,[t("img",{src:s.img("user.svg"),alt:""},null,8,_t),t("div",ht,d((y=e.user)==null?void 0:y.email),1)]),t("div",ut,[t("div",gt,"Số dư: "+d(s.formatnumber(((p=e.user)==null?void 0:p.balance)??0)),1),t("div",mt,[t("img",{src:s.img("icon_point.svg"),alt:""},null,8,vt),yt])])]),t("div",pt,[t("div",null,[t("div",ft,[t("img",{src:s.img("icon_device.svg"),alt:""},null,8,xt),wt,t("div",bt,d(((f=e.user)==null?void 0:f.name_device)??"Chưa kết nối thiết bị nào"),1),t("div",{onClick:a[0]||(a[0]=i=>s.confirmDeleteDevice()),class:u(["delete-device",{no_active:!e.user.delete_device}])},"Xoá thiết bị",2)]),t("div",kt,"Được làm mới thiết bị sau: "+d(s.calculateDeviceRefreshTime(((x=e.user)==null?void 0:x.active_at)??0)),1)]),t("div",Dt,[t("div",{class:"buy flex-al gap-5",onClick:a[1]||(a[1]=(...i)=>s.goToBuyPackage&&s.goToBuyPackage(...i))},[t("img",{src:s.img("icon_buy.svg"),alt:""},null,8,Pt),Tt]),t("div",{onClick:a[2]||(a[2]=(...i)=>s.goToBuyPoint&&s.goToBuyPoint(...i)),class:"button flex-al-jt"},"Nạp Point")])])]),t("div",Mt,[t("div",Ct,[t("div",{class:u(["flex-al items-center gap-3",{active:e.type_manage==="goi"}]),onClick:a[3]||(a[3]=i=>e.type_manage="goi")},[v(g,{size:"20",src:s.img("icon_goi.svg"),alt:""},null,8,["src"]),Yt],2),t("div",{class:u(["flex-al items-center gap-3",{active:e.type_manage==="giaodich"}]),onClick:a[4]||(a[4]=i=>e.type_manage="giaodich")},[v(g,{size:"20",src:s.img("icon_card.svg"),alt:""},null,8,["src"]),Ht],2),t("div",{class:u(["flex-al items-center gap-3",{active:e.type_manage==="history"}]),onClick:a[5]||(a[5]=i=>e.type_manage="history")},[v(g,{size:"20",src:s.img("icon_history.svg"),alt:""},null,8,["src"]),Bt],2)]),e.type_manage==="goi"?(c(),l("div",Rt,[t("div",St,[t("img",{src:s.getPackageIcon((w=e.user)==null?void 0:w.name_package),alt:""},null,8,zt),t("div",At,"Gói cước : "+d(((b=e.user)==null?void 0:b.purchase_term)??0)+" tháng",1)]),e.user.has_expired?(c(),l("div",Et,[t("div",Ot,[t("img",{src:s.img("icon_clock.svg"),alt:""},null,8,It),t("div",null,[t("div",Lt,"Gói cước: "+d((k=e.user)==null?void 0:k.purchase_term)+" tháng của bạn đã hết hạn",1)])]),qt])):r("",!0),t("div",Nt,[Vt,t("div",jt,[t("div",null,"Thời hạn mua: "+d((D=e.user)==null?void 0:D.purchase_term)+" tháng",1),Gt,t("div",Qt," Còn "+d(s.formatExpiryDateMonth((P=e.user)==null?void 0:P.expiry_date)),1),t("div",Ut," ( hết hạn vào ngày "+d(s.formatExpiryDate((T=e.user)==null?void 0:T.expiry_date))+") ",1)])]),t("div",Ft,[t("div",null,[Wt,t("div",Xt,[t("div",null,d(s.formatnumber(((M=e.user)==null?void 0:M.number_minutes_subtitle)??0))+" phút",1),Kt,t("div",{class:u(s.getColorByPercentage((C=e.user)==null?void 0:C.number_minutes_subtitle,(Y=e.user)==null?void 0:Y.minutes_used))}," Còn lại: "+d(s.calculateRemainingMinutes(((H=e.user)==null?void 0:H.number_minutes_subtitle)??0,((B=e.user)==null?void 0:B.minutes_used)??0))+" phút ",3)]),t("div",Jt,[t("div",{class:u(["item",s.getColorByPercentage(((R=e.user)==null?void 0:R.number_minutes_subtitle)??0,((S=e.user)==null?void 0:S.minutes_used)??0)]),style:U({width:s.calculatePercentageWidth(((z=e.user)==null?void 0:z.number_minutes_subtitle)??0,((A=e.user)==null?void 0:A.minutes_used)??0)})},null,6)])])]),t("div",Zt,[t("div",null,[$t,t("div",te,[t("div",null,d(s.formatnumber(((E=e.user)==null?void 0:E.number_voice_characters)??0))+" ký tự",1),ee,t("div",{class:u(s.getColorByPercentage((O=e.user)==null?void 0:O.number_voice_characters,(I=e.user)==null?void 0:I.voice_used))}," Còn lại: "+d(s.calculateRemainingMinutes(((L=e.user)==null?void 0:L.number_voice_characters)??0,((q=e.user)==null?void 0:q.voice_used)??0))+" ký tự ",3)]),t("div",se,[t("div",{class:u(["item",s.getColorByPercentage((N=e.user)==null?void 0:N.number_voice_characters,(V=e.user)==null?void 0:V.voice_used)]),style:U({width:s.calculatePercentageWidth((j=e.user)==null?void 0:j.number_voice_characters,(G=e.user)==null?void 0:G.voice_used)})},null,6)])])])])):r("",!0),e.type_manage==="giaodich"?(c(),l("div",ie,[t("div",ne,[t("div",ae,[t("div",{class:u(["item-select",{active:e.type_transaction==="payment"}]),onClick:a[6]||(a[6]=i=>e.type_transaction="payment")},"Thanh toán",2),t("div",{class:u(["item-select",{active:e.type_transaction==="history"}]),onClick:a[7]||(a[7]=i=>e.type_transaction="history")},"Lịch sử nạp",2)]),t("div",oe,[t("img",{src:s.img("icon_lich.svg"),alt:""},null,8,ce),le,t("img",{src:s.img("icon_arrow.svg"),alt:""},null,8,re)])]),t("div",de,[t("div",_e,[he,ue,e.type_transaction==="payment"?(c(),l("div",ge,"Loại")):r("",!0),e.type_transaction==="payment"?(c(),l("div",me,"Chi tiết")):r("",!0),e.type_transaction==="history"?(c(),l("div",ve,"Đại lý hỗ trợ")):r("",!0),ye]),t("div",pe,[(c(!0),l(J,null,Z(e.dataPaymentHistory,i=>(c(),l("div",{class:"items-transaction flex-al",key:i.id},[t("div",fe,d(s.formatExpiryDate(i==null?void 0:i.created_at)),1),t("div",xe,[e.type_transaction==="payment"?(c(),l("div",we,"-"+d(s.formatnumber((i==null?void 0:i.transaction_value)??0)),1)):r("",!0),e.type_transaction==="history"?(c(),l("div",be,"+"+d(s.formatnumber((i==null?void 0:i.transaction_value)??0)),1)):r("",!0),t("div",ke,[t("img",{src:s.img("icon_point.svg"),alt:""},null,8,De),Pe])]),e.type_transaction==="payment"?(c(),l("div",Te,[(i==null?void 0:i.type_payment)==="package"?(c(),l("div",Me,"Mua gói : "+d(i==null?void 0:i.name_package),1)):r("",!0),(i==null?void 0:i.type_payment)==="subtitle"?(c(),l("div",Ce,"Mua tách phụ đề")):r("",!0),(i==null?void 0:i.type_payment)==="voice"?(c(),l("div",Ye,"Mua ký tự lồng tiếng")):r("",!0)])):r("",!0),e.type_transaction==="payment"?(c(),l("div",He,[i!=null&&i.number_minutes_subtitle?(c(),l("div",Be,"Tách phụ đề: "+d(s.formatnumber((i==null?void 0:i.number_minutes_subtitle)??0))+" phút",1)):r("",!0),i!=null&&i.number_voice_characters?(c(),l("div",Re,"Lồng tiếng: "+d(s.formatnumber((i==null?void 0:i.number_voice_characters)??0))+" ký tự",1)):r("",!0)])):r("",!0),e.type_transaction==="history"?(c(),l("div",Se,d(i==null?void 0:i.name_agency),1)):r("",!0),t("div",ze,[i.status==="success"?(c(),l("div",Ae,"Thành công")):r("",!0)])]))),128)),e.type_transaction==="payment"?tt((c(),l("div",Ee,null,512)),[[m,s.loadMorePayment]]):r("",!0)])])])):r("",!0),e.type_manage==="history"?(c(),l("div",Oe,[t("div",Ie,[t("div",Le,[t("img",{src:s.img("icon_lich.svg"),alt:""},null,8,qe),Ne,t("img",{src:s.img("icon_arrow.svg"),alt:""},null,8,Ve)]),t("div",{class:"selects-type flex-al gap-6 popup-class",onClick:a[8]||(a[8]=i=>s.clickpageAccount("show_history_action"))},[t("img",{src:s.img("icon_filter.svg"),alt:""},null,8,je),Ge,t("img",{src:s.img("icon_arrow.svg"),alt:""},null,8,Qe),e.show_history_action?(c(),l("div",Ue,Ke)):r("",!0)])]),Je])):r("",!0)])]),e.isConfirmDeleteDevice?(c(),l("div",Ze,[t("div",$e,[t("div",null,[t("img",{src:s.img("icon_warning_device.svg"),alt:""},null,8,ts)]),es,ss,t("div",{class:"button-delete mgt-30 fw-600",style:{width:"100%"},onClick:a[9]||(a[9]=(...i)=>s.deleteDevice&&s.deleteDevice(...i))},"Xoá thiết bị")])])):r("",!0)])}typeof Q=="function"&&Q(F);const os=W(F,[["render",is],["__scopeId","data-v-a410a737"]]);export{os as default};
