import{b as X}from"./route-block-83d24a4e.js";import{_ as J,r as Z,g as ee,o,c,a as e,t as r,h,b as _,d as v,n as F,F as te,e as se,i as ne,p as ie,j as ae}from"./index-f2ee448c.js";const K={data(){return{type_manage:"goi",type_transaction:"payment",dateRange:"",dataPaymentHistory:[],user:{},isConfirmDeleteDevice:!1,pagination:{current_page:1,per_page:25,total:0,total_pages:0,loading:!1}}},watch:{type_manage(i){i==="giaodich"&&setTimeout(()=>{this.openDateRangePicker()},500)},type_transaction(i){this.dataPaymentHistory=[],this.pagination.current_page=1,this.getPaymentHistory()},dateRange(i){this.dataPaymentHistory=[],this.pagination.current_page=1,this.getPaymentHistory()}},created(){this.getUser(),this.getPaymentHistory()},methods:{img(i){return"images/admin-panel/"+i},getColorByPercentage(i,a){const d=i??0,s=(d-(a??0))/d*100;return s>50?"text-green":s>30?"text-yellow":"text-red"},confirmDeleteDevice(){var i;this.canDeleteDevice(((i=this.user)==null?void 0:i.active_at)??0)&&(this.isConfirmDeleteDevice=!0)},async deleteDevice(){var a;if(!this.canDeleteDevice(((a=this.user)==null?void 0:a.active_at)??0))return;let i=await this.api({path:"/web/user/delete-device",method:"POST"});console.log(i,"delete device")},goToBuyPackage(){this.$router.push("/buy-pankage")},goToBuySubtitle(){this.$router.push("/buy-subtitle")},goToBuyVoice(){this.$router.push("/buy-voice")},loadMorePayment(i){i&&!this.pagination.loading&&this.pagination.current_page<this.pagination.total_pages&&(this.pagination.current_page+=1,this.getPaymentHistory())},async getPaymentHistory(){if(this.pagination.loading)return;this.pagination.loading=!0;let i=await this.api({path:"/web/user/get-payment",params:{date_range:this.dateRange,type:this.type_transaction,page:this.pagination.current_page,limit:this.pagination.per_page}});console.log(i,"payment history"),i.success&&(this.dataPaymentHistory=[...this.dataPaymentHistory,...i.payment_history],this.pagination.total=i.pagination.total,this.pagination.total_pages=i.pagination.total_pages,this.pagination.loading=!1)},canDeleteDevice(i){if(!i)return!1;const a=new Date(i),d=new Date(a.setMonth(a.getMonth()+1)),u=new Date;return d.getTime()<=u.getTime()},calculateDeviceRefreshTime(i){if(!i)return"0 ngày";const a=new Date(i),d=new Date(a.setMonth(a.getMonth()+1)),u=new Date,t=d.getTime()-u.getTime();return t<=0?"0 ngày":`${Math.ceil(t/(1e3*60*60*24))} ngày nữa`},async getUser(i=3){try{let a=await this.api({path:"/web/user/get-info"});if(console.log(a,"user info"),a.success)this.user=a.data_user;else throw new Error("API request failed")}catch(a){if(console.error("Error fetching user info:",a),i>0)return console.log(`Retrying... ${i} attempts left`),await new Promise(d=>setTimeout(d,1e3)),this.getUser(i-1);console.error("Max retry attempts reached")}},formatnumber(i){return i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},getPackageIcon(i){const a={Normal:"icon_plus.svg",Pro:"icon_Pro.svg",Advance:"icon_Advance.svg"};return this.img(a[i]||"default_icon.svg")},formatExpiryDate(i){return moment(i).format("HH:mm - DD/MM/YYYY ")},calculatePercentageWidth(i,a){const d=i??0,u=a??0;if(d===0)return"0%";const s=(d-u)/d*100;return`${Math.min(100,Math.max(0,s))}%`},calculateRemainingMinutes(i,a){const t=(i??0)-(a??0);return this.formatnumber(t)},formatExpiryDateMonth(i){if(!i)return"0 ngày";const a=new Date,u=new Date(i).getTime()-a.getTime();if(u<=0)return"0 ngày";const t=Math.floor(u/(1e3*60*60*24)),s=Math.floor(u%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(t/30),m=t%30;return g>0?m===0?`${g} tháng`:m===1?`${g} tháng 1 ngày`:`${g} tháng ${m} ngày`:t>0?t===1?"1 ngày":`${t} ngày`:s===1?"1 giờ":`${s} giờ`},openDateRangePicker(){console.log("openDateRangePicker"),$('input[name="datetimes_payment"]').daterangepicker({ranges:{"Hôm nay":[moment(),moment()],"Hôm qua":[moment().subtract(1,"days"),moment().subtract(1,"days")],"7 ngày qua":[moment().subtract(6,"days"),moment()],"30 ngày qua":[moment().subtract(29,"days"),moment()],"Tháng này":[moment().startOf("month"),moment().endOf("month")],"Tháng trước":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:!0,startDate:"27/10/2024",endDate:"02/11/2024",locale:{format:"DD/MM/YYYY"}},(i,a,d)=>{this.dateRange=i.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY"),console.log(i.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY"))})}}},l=i=>(ie("data-v-7007b69d"),i=i(),ae(),i),oe={class:"container-settings"},ce=l(()=>e("div",{class:"spaces"},null,-1)),le={class:"contents"},re={class:"info"},_e={class:"flex-bw-al"},de={class:"flex-al gap-10"},ue=["src"],he={class:"fw-600 fz-20 text-long1"},ge={class:"flex-al gap-6 fz-16"},me={class:"text-green"},ve={class:"flex-al gap-3"},ye=["src"],fe=l(()=>e("div",{class:"text-yellow fw-600"},"Point",-1)),pe={class:"flex-bw-al mgt-15"},xe={class:"flex-al gap-3"},be=["src"],we=l(()=>e("div",null,"Thiết bị đang kết nối:",-1)),ke={class:"text-yellow"},De={key:0,class:"text-300 mgt-10"},Me={class:"flex gap-10"},Pe=["src"],Te=l(()=>e("div",null,"Mua gói",-1)),Ce=l(()=>e("div",{class:"button flex-al-jt"},"Nạp Point",-1)),Ye={class:"table"},Be={class:"header flex-al"},He=l(()=>e("div",null,"Quản lý gói cước",-1)),Se=l(()=>e("div",null,"Quản lý giao dịch",-1)),Re=l(()=>e("div",null,"Lịch sử hành động",-1)),ze={key:0,class:"body"},Ie={class:"flex-al gap-5"},Ae=["src"],Ee={class:"fz-24 fw-600"},je={key:0,class:"expired flex-bw-al"},Le={class:"flex-al gap-5"},Oe=["src"],Ve={class:"text-red fz-16 fw-500"},Ne=l(()=>e("div",{class:"text-yellow fz-16 fw-600"},"Gia hạn ngay",-1)),qe={class:"infos"},Ge=l(()=>e("div",{class:"title-info"},"Thời hạn gói cước",-1)),Qe={class:"contens-info flex-al gap-3"},Ue=l(()=>e("div",{class:"text-300"},"-",-1)),We={class:"text-yellow"},Xe={class:"text-300"},Fe={class:"infos flex-bw-al"},Ke=l(()=>e("div",{class:"title-info"},"Số phút tách phụ đề",-1)),Je={class:"flex-al contens-info gap-5"},Ze=l(()=>e("div",{class:"curso"},null,-1)),$e={class:"loading"},et={class:"infos flex-bw-al"},tt=l(()=>e("div",{class:"title-info"},"Ký tự lồng tiếng",-1)),st={class:"flex-al contens-info gap-5"},nt=l(()=>e("div",{class:"curso"},null,-1)),it={class:"loading"},at={key:1,class:"transaction"},ot={class:"config flex-bw-al"},ct={class:"flex select-transaction"},lt={class:"selects-type flex-al gap-3"},rt=["src"],_t=l(()=>e("div",{class:"text-300"},[e("input",{type:"text",name:"datetimes_payment",class:"text-300"})],-1)),dt=["src"],ut={class:"body-transaction"},ht={class:"header-transaction flex-al"},gt=l(()=>e("div",{class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},"Thời gian",-1)),mt=l(()=>e("div",{class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},"Giá trị giao dịch",-1)),vt={key:0,class:"titles-transaction",style:{"min-width":"250px"}},yt={key:1,class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},ft={key:2,class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},pt=l(()=>e("div",{class:"titles-transaction",style:{"min-width":"150px"}},"Trạng thái",-1)),xt={class:"table-transaction"},bt={class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},wt={class:"titles-transaction flex-al gap-10",style:{"min-width":"250px",width:"100%"}},kt={key:0,class:"text-red"},Dt={key:1,class:"text-green"},Mt={class:"flex-al gap-5"},Pt=["src"],Tt=l(()=>e("div",{class:"text-yellow fw-600"},"Point",-1)),Ct={key:0,class:"titles-transaction",style:{"min-width":"250px"}},Yt={key:0},Bt={key:1},Ht={key:2},St={key:1,class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},Rt={key:0,class:"flex-al text-300"},zt={key:1,class:"flex-al mgt-10 text-300"},It={key:2,class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},At={class:"titles-transaction",style:{"min-width":"150px"}},Et={key:0,class:"text-green"},jt={key:0,ref:"sentinel",class:"sentinel"},Lt={key:0,class:"confirm-delete-device flex-al-jt"},Ot={class:"confirm-delete-device-content flex-cl-al"},Vt=["src"],Nt=l(()=>e("div",{class:"fw-600 fz-16"},"Xác nhận xoá thiết bị",-1)),qt=l(()=>e("div",{class:"text-300 mgt-10 text-al"},"Sau khi xoá thiết bị hiện tại, bạn có thể kết nối tài khoản QuickMagic với một thiết bị khác.",-1));function Gt(i,a,d,u,t,s){var y,f,p,x,b,w,k,D,M,P,T,C,Y,B,H,S,R,z,I,A,E,j,L,O,V,N,q,G,Q,U,W;const g=Z("Icon"),m=ee("observe-visibility");return o(),c("div",oe,[ce,e("div",le,[e("div",re,[e("div",_e,[e("div",de,[e("img",{src:s.img("user.svg"),alt:""},null,8,ue),e("div",he,r((y=t.user)==null?void 0:y.email),1)]),e("div",ge,[e("div",me,"Số dư: "+r(s.formatnumber(((f=t.user)==null?void 0:f.balance)??0)),1),e("div",ve,[e("img",{src:s.img("icon_point.svg"),alt:""},null,8,ye),fe])])]),e("div",pe,[e("div",null,[e("div",xe,[e("img",{src:s.img("icon_device.svg"),alt:""},null,8,be),we,e("div",ke,r(((p=t.user)==null?void 0:p.name_device)??"Chưa kết nối thiết bị nào"),1),e("div",{onClick:a[0]||(a[0]=n=>s.confirmDeleteDevice()),class:h(["delete-device",{no_active:!((x=t.user)!=null&&x.name_device)||!s.canDeleteDevice(((b=t.user)==null?void 0:b.active_at)??0)}])},"Xoá thiết bị",2)]),(w=t.user)!=null&&w.name_device?(o(),c("div",De,"Được làm mới thiết bị sau: "+r(s.calculateDeviceRefreshTime(((k=t.user)==null?void 0:k.active_at)??0)),1)):_("",!0)]),e("div",Me,[e("div",{class:"buy flex-al gap-5",onClick:a[1]||(a[1]=(...n)=>s.goToBuyPackage&&s.goToBuyPackage(...n))},[e("img",{src:s.img("icon_buy.svg"),alt:""},null,8,Pe),Te]),Ce])])]),e("div",Ye,[e("div",Be,[e("div",{class:h(["flex-al items-center gap-3",{active:t.type_manage==="goi"}]),onClick:a[2]||(a[2]=n=>t.type_manage="goi")},[v(g,{size:"20",src:s.img("icon_goi.svg"),alt:""},null,8,["src"]),He],2),e("div",{class:h(["flex-al items-center gap-3",{active:t.type_manage==="giaodich"}]),onClick:a[3]||(a[3]=n=>t.type_manage="giaodich")},[v(g,{size:"20",src:s.img("icon_card.svg"),alt:""},null,8,["src"]),Se],2),e("div",{class:h(["flex-al items-center gap-3",{active:t.type_manage==="history"}]),onClick:a[4]||(a[4]=n=>t.type_manage="history")},[v(g,{size:"20",src:s.img("icon_history.svg"),alt:""},null,8,["src"]),Re],2)]),t.type_manage==="goi"?(o(),c("div",ze,[e("div",Ie,[e("img",{src:s.getPackageIcon((D=t.user)==null?void 0:D.name_package),alt:""},null,8,Ae),e("div",Ee,"Gói cước : "+r((M=t.user)==null?void 0:M.purchase_term)+" tháng",1)]),t.user.has_expired?(o(),c("div",je,[e("div",Le,[e("img",{src:s.img("icon_clock.svg"),alt:""},null,8,Oe),e("div",null,[e("div",Ve,"Gói cước: "+r((P=t.user)==null?void 0:P.purchase_term)+" tháng của bạn đã hết hạn",1)])]),Ne])):_("",!0),e("div",qe,[Ge,e("div",Qe,[e("div",null,"Thời hạn mua: "+r((T=t.user)==null?void 0:T.purchase_term)+" tháng",1),Ue,e("div",We," Còn "+r(s.formatExpiryDateMonth((C=t.user)==null?void 0:C.expiry_date)),1),e("div",Xe," ( hết hạn vào ngày "+r(s.formatExpiryDate((Y=t.user)==null?void 0:Y.expiry_date))+") ",1)])]),e("div",Fe,[e("div",null,[Ke,e("div",Je,[e("div",null,r(s.formatnumber(((B=t.user)==null?void 0:B.number_minutes_subtitle)??0))+" phút",1),Ze,e("div",{class:h(s.getColorByPercentage((H=t.user)==null?void 0:H.number_minutes_subtitle,(S=t.user)==null?void 0:S.minutes_used))}," Còn lại: "+r(s.calculateRemainingMinutes(((R=t.user)==null?void 0:R.number_minutes_subtitle)??0,((z=t.user)==null?void 0:z.minutes_used)??0))+" phút ",3)]),e("div",$e,[e("div",{class:h(["item",s.getColorByPercentage(((I=t.user)==null?void 0:I.number_minutes_subtitle)??0,((A=t.user)==null?void 0:A.minutes_used)??0)]),style:F({width:s.calculatePercentageWidth(((E=t.user)==null?void 0:E.number_minutes_subtitle)??0,((j=t.user)==null?void 0:j.minutes_used)??0)})},null,6)])]),e("div",{class:"buy-minutes flex-al-jt",onClick:a[5]||(a[5]=(...n)=>s.goToBuySubtitle&&s.goToBuySubtitle(...n))},"Mua thêm")]),e("div",et,[e("div",null,[tt,e("div",st,[e("div",null,r(s.formatnumber(((L=t.user)==null?void 0:L.number_voice_characters)??0))+" ký tự",1),nt,e("div",{class:h(s.getColorByPercentage((O=t.user)==null?void 0:O.number_voice_characters,(V=t.user)==null?void 0:V.voice_used))}," Còn lại: "+r(s.calculateRemainingMinutes(((N=t.user)==null?void 0:N.number_voice_characters)??0,((q=t.user)==null?void 0:q.voice_used)??0))+" ký tự ",3)]),e("div",it,[e("div",{class:h(["item",s.getColorByPercentage((G=t.user)==null?void 0:G.number_voice_characters,(Q=t.user)==null?void 0:Q.voice_used)]),style:F({width:s.calculatePercentageWidth((U=t.user)==null?void 0:U.number_voice_characters,(W=t.user)==null?void 0:W.voice_used)})},null,6)])]),e("div",{class:"buy-minutes flex-al-jt",onClick:a[6]||(a[6]=(...n)=>s.goToBuyVoice&&s.goToBuyVoice(...n))},"Mua thêm")])])):_("",!0),t.type_manage==="giaodich"?(o(),c("div",at,[e("div",ot,[e("div",ct,[e("div",{class:h(["item-select",{active:t.type_transaction==="payment"}]),onClick:a[7]||(a[7]=n=>t.type_transaction="payment")},"Thanh toán",2),e("div",{class:h(["item-select",{active:t.type_transaction==="history"}]),onClick:a[8]||(a[8]=n=>t.type_transaction="history")},"Lịch sử nạp",2)]),e("div",lt,[e("img",{src:s.img("icon_lich.svg"),alt:""},null,8,rt),_t,e("img",{src:s.img("icon_arrow.svg"),alt:""},null,8,dt)])]),e("div",ut,[e("div",ht,[gt,mt,t.type_transaction==="payment"?(o(),c("div",vt,"Loại")):_("",!0),t.type_transaction==="payment"?(o(),c("div",yt,"Chi tiết")):_("",!0),t.type_transaction==="history"?(o(),c("div",ft,"Đại lý hỗ trợ")):_("",!0),pt]),e("div",xt,[(o(!0),c(te,null,se(t.dataPaymentHistory,n=>(o(),c("div",{class:"items-transaction flex-al",key:n.id},[e("div",bt,r(s.formatExpiryDate(n==null?void 0:n.created_at)),1),e("div",wt,[t.type_transaction==="payment"?(o(),c("div",kt,"-"+r(s.formatnumber((n==null?void 0:n.transaction_value)??0)),1)):_("",!0),t.type_transaction==="history"?(o(),c("div",Dt,"+"+r(s.formatnumber((n==null?void 0:n.transaction_value)??0)),1)):_("",!0),e("div",Mt,[e("img",{src:s.img("icon_point.svg"),alt:""},null,8,Pt),Tt])]),t.type_transaction==="payment"?(o(),c("div",Ct,[(n==null?void 0:n.type_payment)==="package"?(o(),c("div",Yt,"Mua gói : "+r(n==null?void 0:n.name_package),1)):_("",!0),(n==null?void 0:n.type_payment)==="subtitle"?(o(),c("div",Bt,"Mua tách phụ đề")):_("",!0),(n==null?void 0:n.type_payment)==="voice"?(o(),c("div",Ht,"Mua ký tự lồng tiếng")):_("",!0)])):_("",!0),t.type_transaction==="payment"?(o(),c("div",St,[n!=null&&n.number_minutes_subtitle?(o(),c("div",Rt,"Tách phụ đề: "+r(s.formatnumber((n==null?void 0:n.number_minutes_subtitle)??0))+" phút",1)):_("",!0),n!=null&&n.number_voice_characters?(o(),c("div",zt,"Lồng tiếng: "+r(s.formatnumber((n==null?void 0:n.number_voice_characters)??0))+" ký tự",1)):_("",!0)])):_("",!0),t.type_transaction==="history"?(o(),c("div",It,r(n==null?void 0:n.name_agency),1)):_("",!0),e("div",At,[n.status==="success"?(o(),c("div",Et,"Thành công")):_("",!0)])]))),128)),t.type_transaction==="payment"?ne((o(),c("div",jt,null,512)),[[m,s.loadMorePayment]]):_("",!0)])])])):_("",!0)])]),t.isConfirmDeleteDevice?(o(),c("div",Lt,[e("div",Ot,[e("div",null,[e("img",{src:s.img("icon_warning_device.svg"),alt:""},null,8,Vt)]),Nt,qt,e("div",{class:"button-delete mgt-30 fw-600",style:{width:"100%"},onClick:a[9]||(a[9]=(...n)=>s.deleteDevice&&s.deleteDevice(...n))},"Xoá thiết bị")])])):_("",!0)])}typeof X=="function"&&X(K);const Wt=J(K,[["render",Gt],["__scopeId","data-v-7007b69d"]]);export{Wt as default};
