import{b as U}from"./route-block-83d24a4e.js";import{_ as X,r as F,g as K,o,c,a as t,t as r,h,d as y,b as _,n as Q,F as J,e as Z,i as tt,p as et,j as st}from"./index-ac4777e4.js";const W={data(){return{type_manage:"goi",type_transaction:"payment",dateRange:"",dataPaymentHistory:[],user:{},isConfirmDeleteDevice:!1,pagination:{current_page:1,per_page:25,total:0,total_pages:0,loading:!1}}},watch:{type_manage(i){i==="giaodich"&&setTimeout(()=>{this.openDateRangePicker()},500)},type_transaction(i){this.dataPaymentHistory=[],this.pagination.current_page=1,this.getPaymentHistory()},dateRange(i){this.dataPaymentHistory=[],this.pagination.current_page=1,this.getPaymentHistory()}},created(){this.getUser(),this.getPaymentHistory()},methods:{img(i){return"images/admin-panel/"+i},getColorByPercentage(i,a){const d=i??0,n=(d-(a??0))/d*100;return n>50?"text-green":n>30?"text-yellow":"text-red"},confirmDeleteDevice(){this.isConfirmDeleteDevice=!0},async deleteDevice(){(await this.api({path:"/web/user/delete-device",method:"POST"})).success&&(this.isConfirmDeleteDevice=!1,this.getUser())},goToBuyPackage(){this.$router.push("/buy-pankage")},goToBuySubtitle(){this.$router.push("/buy-subtitle")},goToBuyVoice(){this.$router.push("/buy-voice")},loadMorePayment(i){i&&!this.pagination.loading&&this.pagination.current_page<this.pagination.total_pages&&(this.pagination.current_page+=1,this.getPaymentHistory())},async getPaymentHistory(){if(this.pagination.loading)return;this.pagination.loading=!0;let i=await this.api({path:"/web/user/get-payment",params:{date_range:this.dateRange,type:this.type_transaction,page:this.pagination.current_page,limit:this.pagination.per_page}});console.log(i,"payment history"),i.success&&(this.dataPaymentHistory=[...this.dataPaymentHistory,...i.payment_history],this.pagination.total=i.pagination.total,this.pagination.total_pages=i.pagination.total_pages,this.pagination.loading=!1)},calculateDeviceRefreshTime(i){if(!i)return"0 ngày";const a=new Date(i),d=new Date(a.setMonth(a.getMonth()+1)),u=new Date,e=d.getTime()-u.getTime();return e<=0?"0 ngày":`${Math.ceil(e/(1e3*60*60*24))} ngày nữa`},async getUser(i=3){try{let a=await this.api({path:"/web/user/get-info"});if(console.log(a,"user info"),a.success)this.user=a.data_user;else throw new Error("API request failed")}catch(a){if(console.error("Error fetching user info:",a),i>0)return console.log(`Retrying... ${i} attempts left`),await new Promise(d=>setTimeout(d,1e3)),this.getUser(i-1);console.error("Max retry attempts reached")}},formatnumber(i){return i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},getPackageIcon(i){const a={Normal:"icon_plus.svg",Pro:"icon_Pro.svg",Advance:"icon_Advance.svg"};return this.img(a[i]||"default_icon.svg")},formatExpiryDate(i){return moment(i).format("HH:mm - DD/MM/YYYY ")},calculatePercentageWidth(i,a){const d=i??0,u=a??0;if(d===0)return"0%";const n=(d-u)/d*100;return`${Math.min(100,Math.max(0,n))}%`},calculateRemainingMinutes(i,a){const e=(i??0)-(a??0);return this.formatnumber(e)},formatExpiryDateMonth(i){if(!i)return"0 ngày";const a=new Date,u=new Date(i).getTime()-a.getTime();if(u<=0)return"0 ngày";const e=Math.floor(u/(1e3*60*60*24)),n=Math.floor(u%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(e/30),m=e%30;return g>0?m===0?`${g} tháng`:m===1?`${g} tháng 1 ngày`:`${g} tháng ${m} ngày`:e>0?e===1?"1 ngày":`${e} ngày`:n===1?"1 giờ":`${n} giờ`},openDateRangePicker(){console.log("openDateRangePicker"),$('input[name="datetimes_payment"]').daterangepicker({ranges:{"Hôm nay":[moment(),moment()],"Hôm qua":[moment().subtract(1,"days"),moment().subtract(1,"days")],"7 ngày qua":[moment().subtract(6,"days"),moment()],"30 ngày qua":[moment().subtract(29,"days"),moment()],"Tháng này":[moment().startOf("month"),moment().endOf("month")],"Tháng trước":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:!0,startDate:"27/10/2024",endDate:"02/11/2024",locale:{format:"DD/MM/YYYY"}},(i,a,d)=>{this.dateRange=i.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY"),console.log(i.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY"))})}}},l=i=>(et("data-v-2525f5c5"),i=i(),st(),i),nt={class:"container-settings"},it=l(()=>t("div",{class:"spaces"},null,-1)),at={class:"contents"},ot={class:"info"},ct={class:"flex-bw-al"},lt={class:"flex-al gap-10"},rt=["src"],_t={class:"fw-600 fz-20 text-long1"},dt={class:"flex-al gap-6 fz-16"},ut={class:"text-green"},ht={class:"flex-al gap-3"},gt=["src"],mt=l(()=>t("div",{class:"text-yellow fw-600"},"Point",-1)),yt={class:"flex-bw-al mgt-15"},vt={class:"flex-al gap-3"},ft=["src"],pt=l(()=>t("div",null,"Thiết bị đang kết nối:",-1)),xt={class:"text-yellow"},bt={class:"text-300 mgt-10"},wt={class:"flex gap-10"},kt=["src"],Dt=l(()=>t("div",null,"Mua gói",-1)),Mt=l(()=>t("div",{class:"button flex-al-jt"},"Nạp Point",-1)),Pt={class:"table"},Tt={class:"header flex-al"},Ct=l(()=>t("div",null,"Quản lý gói cước",-1)),Yt=l(()=>t("div",null,"Quản lý giao dịch",-1)),Bt=l(()=>t("div",null,"Lịch sử hành động",-1)),Ht={key:0,class:"body"},St={class:"flex-al gap-5"},Rt=["src"],zt={class:"fz-24 fw-600"},It={key:0,class:"expired flex-bw-al"},At={class:"flex-al gap-5"},Et=["src"],Lt={class:"text-red fz-16 fw-500"},jt=l(()=>t("div",{class:"text-yellow fz-16 fw-600"},"Gia hạn ngay",-1)),Ot={class:"infos"},Vt=l(()=>t("div",{class:"title-info"},"Thời hạn gói cước",-1)),Nt={class:"contens-info flex-al gap-3"},qt=l(()=>t("div",{class:"text-300"},"-",-1)),Gt={class:"text-yellow"},Ut={class:"text-300"},Qt={class:"infos flex-bw-al"},Wt=l(()=>t("div",{class:"title-info"},"Số phút tách phụ đề",-1)),Xt={class:"flex-al contens-info gap-5"},Ft=l(()=>t("div",{class:"curso"},null,-1)),Kt={class:"loading"},Jt={class:"infos flex-bw-al"},Zt=l(()=>t("div",{class:"title-info"},"Ký tự lồng tiếng",-1)),$t={class:"flex-al contens-info gap-5"},te=l(()=>t("div",{class:"curso"},null,-1)),ee={class:"loading"},se={key:1,class:"transaction"},ne={class:"config flex-bw-al"},ie={class:"flex select-transaction"},ae={class:"selects-type flex-al gap-3"},oe=["src"],ce=l(()=>t("div",{class:"text-300"},[t("input",{type:"text",name:"datetimes_payment",class:"text-300"})],-1)),le=["src"],re={class:"body-transaction"},_e={class:"header-transaction flex-al"},de=l(()=>t("div",{class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},"Thời gian",-1)),ue=l(()=>t("div",{class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},"Giá trị giao dịch",-1)),he={key:0,class:"titles-transaction",style:{"min-width":"250px"}},ge={key:1,class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},me={key:2,class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},ye=l(()=>t("div",{class:"titles-transaction",style:{"min-width":"150px"}},"Trạng thái",-1)),ve={class:"table-transaction"},fe={class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},pe={class:"titles-transaction flex-al gap-10",style:{"min-width":"250px",width:"100%"}},xe={key:0,class:"text-red"},be={key:1,class:"text-green"},we={class:"flex-al gap-5"},ke=["src"],De=l(()=>t("div",{class:"text-yellow fw-600"},"Point",-1)),Me={key:0,class:"titles-transaction",style:{"min-width":"250px"}},Pe={key:0},Te={key:1},Ce={key:2},Ye={key:1,class:"titles-transaction",style:{"min-width":"250px",width:"100%"}},Be={key:0,class:"flex-al text-300"},He={key:1,class:"flex-al mgt-10 text-300"},Se={key:2,class:"titles-transaction",style:{"min-width":"200px",width:"100%"}},Re={class:"titles-transaction",style:{"min-width":"150px"}},ze={key:0,class:"text-green"},Ie={key:0,ref:"sentinel",class:"sentinel"},Ae={key:0,class:"confirm-delete-device flex-al-jt"},Ee={class:"confirm-delete-device-content flex-cl-al"},Le=["src"],je=l(()=>t("div",{class:"fw-600 fz-16"},"Xác nhận xoá thiết bị",-1)),Oe=l(()=>t("div",{class:"text-300 mgt-10 text-al"},"Sau khi xoá thiết bị hiện tại, bạn có thể kết nối tài khoản QuickMagic với một thiết bị khác.",-1));function Ve(i,a,d,u,e,n){var v,f,p,x,b,w,k,D,M,P,T,C,Y,B,H,S,R,z,I,A,E,L,j,O,V,N,q,G;const g=F("Icon"),m=K("observe-visibility");return o(),c("div",nt,[it,t("div",at,[t("div",ot,[t("div",ct,[t("div",lt,[t("img",{src:n.img("user.svg"),alt:""},null,8,rt),t("div",_t,r((v=e.user)==null?void 0:v.email),1)]),t("div",dt,[t("div",ut,"Số dư: "+r(n.formatnumber(((f=e.user)==null?void 0:f.balance)??0)),1),t("div",ht,[t("img",{src:n.img("icon_point.svg"),alt:""},null,8,gt),mt])])]),t("div",yt,[t("div",null,[t("div",vt,[t("img",{src:n.img("icon_device.svg"),alt:""},null,8,ft),pt,t("div",xt,r(((p=e.user)==null?void 0:p.name_device)??"Chưa kết nối thiết bị nào"),1),t("div",{onClick:a[0]||(a[0]=s=>n.confirmDeleteDevice()),class:h(["delete-device",{no_active:!e.user.delete_device}])},"Xoá thiết bị",2)]),t("div",bt,"Được làm mới thiết bị sau: "+r(n.calculateDeviceRefreshTime(((x=e.user)==null?void 0:x.active_at)??0)),1)]),t("div",wt,[t("div",{class:"buy flex-al gap-5",onClick:a[1]||(a[1]=(...s)=>n.goToBuyPackage&&n.goToBuyPackage(...s))},[t("img",{src:n.img("icon_buy.svg"),alt:""},null,8,kt),Dt]),Mt])])]),t("div",Pt,[t("div",Tt,[t("div",{class:h(["flex-al items-center gap-3",{active:e.type_manage==="goi"}]),onClick:a[2]||(a[2]=s=>e.type_manage="goi")},[y(g,{size:"20",src:n.img("icon_goi.svg"),alt:""},null,8,["src"]),Ct],2),t("div",{class:h(["flex-al items-center gap-3",{active:e.type_manage==="giaodich"}]),onClick:a[3]||(a[3]=s=>e.type_manage="giaodich")},[y(g,{size:"20",src:n.img("icon_card.svg"),alt:""},null,8,["src"]),Yt],2),t("div",{class:h(["flex-al items-center gap-3",{active:e.type_manage==="history"}]),onClick:a[4]||(a[4]=s=>e.type_manage="history")},[y(g,{size:"20",src:n.img("icon_history.svg"),alt:""},null,8,["src"]),Bt],2)]),e.type_manage==="goi"?(o(),c("div",Ht,[t("div",St,[t("img",{src:n.getPackageIcon((b=e.user)==null?void 0:b.name_package),alt:""},null,8,Rt),t("div",zt,"Gói cước : "+r(((w=e.user)==null?void 0:w.purchase_term)??0)+" tháng",1)]),e.user.has_expired?(o(),c("div",It,[t("div",At,[t("img",{src:n.img("icon_clock.svg"),alt:""},null,8,Et),t("div",null,[t("div",Lt,"Gói cước: "+r((k=e.user)==null?void 0:k.purchase_term)+" tháng của bạn đã hết hạn",1)])]),jt])):_("",!0),t("div",Ot,[Vt,t("div",Nt,[t("div",null,"Thời hạn mua: "+r((D=e.user)==null?void 0:D.purchase_term)+" tháng",1),qt,t("div",Gt," Còn "+r(n.formatExpiryDateMonth((M=e.user)==null?void 0:M.expiry_date)),1),t("div",Ut," ( hết hạn vào ngày "+r(n.formatExpiryDate((P=e.user)==null?void 0:P.expiry_date))+") ",1)])]),t("div",Qt,[t("div",null,[Wt,t("div",Xt,[t("div",null,r(n.formatnumber(((T=e.user)==null?void 0:T.number_minutes_subtitle)??0))+" phút",1),Ft,t("div",{class:h(n.getColorByPercentage((C=e.user)==null?void 0:C.number_minutes_subtitle,(Y=e.user)==null?void 0:Y.minutes_used))}," Còn lại: "+r(n.calculateRemainingMinutes(((B=e.user)==null?void 0:B.number_minutes_subtitle)??0,((H=e.user)==null?void 0:H.minutes_used)??0))+" phút ",3)]),t("div",Kt,[t("div",{class:h(["item",n.getColorByPercentage(((S=e.user)==null?void 0:S.number_minutes_subtitle)??0,((R=e.user)==null?void 0:R.minutes_used)??0)]),style:Q({width:n.calculatePercentageWidth(((z=e.user)==null?void 0:z.number_minutes_subtitle)??0,((I=e.user)==null?void 0:I.minutes_used)??0)})},null,6)])]),t("div",{class:"buy-minutes flex-al-jt",onClick:a[5]||(a[5]=(...s)=>n.goToBuySubtitle&&n.goToBuySubtitle(...s))},"Mua thêm")]),t("div",Jt,[t("div",null,[Zt,t("div",$t,[t("div",null,r(n.formatnumber(((A=e.user)==null?void 0:A.number_voice_characters)??0))+" ký tự",1),te,t("div",{class:h(n.getColorByPercentage((E=e.user)==null?void 0:E.number_voice_characters,(L=e.user)==null?void 0:L.voice_used))}," Còn lại: "+r(n.calculateRemainingMinutes(((j=e.user)==null?void 0:j.number_voice_characters)??0,((O=e.user)==null?void 0:O.voice_used)??0))+" ký tự ",3)]),t("div",ee,[t("div",{class:h(["item",n.getColorByPercentage((V=e.user)==null?void 0:V.number_voice_characters,(N=e.user)==null?void 0:N.voice_used)]),style:Q({width:n.calculatePercentageWidth((q=e.user)==null?void 0:q.number_voice_characters,(G=e.user)==null?void 0:G.voice_used)})},null,6)])]),t("div",{class:"buy-minutes flex-al-jt",onClick:a[6]||(a[6]=(...s)=>n.goToBuyVoice&&n.goToBuyVoice(...s))},"Mua thêm")])])):_("",!0),e.type_manage==="giaodich"?(o(),c("div",se,[t("div",ne,[t("div",ie,[t("div",{class:h(["item-select",{active:e.type_transaction==="payment"}]),onClick:a[7]||(a[7]=s=>e.type_transaction="payment")},"Thanh toán",2),t("div",{class:h(["item-select",{active:e.type_transaction==="history"}]),onClick:a[8]||(a[8]=s=>e.type_transaction="history")},"Lịch sử nạp",2)]),t("div",ae,[t("img",{src:n.img("icon_lich.svg"),alt:""},null,8,oe),ce,t("img",{src:n.img("icon_arrow.svg"),alt:""},null,8,le)])]),t("div",re,[t("div",_e,[de,ue,e.type_transaction==="payment"?(o(),c("div",he,"Loại")):_("",!0),e.type_transaction==="payment"?(o(),c("div",ge,"Chi tiết")):_("",!0),e.type_transaction==="history"?(o(),c("div",me,"Đại lý hỗ trợ")):_("",!0),ye]),t("div",ve,[(o(!0),c(J,null,Z(e.dataPaymentHistory,s=>(o(),c("div",{class:"items-transaction flex-al",key:s.id},[t("div",fe,r(n.formatExpiryDate(s==null?void 0:s.created_at)),1),t("div",pe,[e.type_transaction==="payment"?(o(),c("div",xe,"-"+r(n.formatnumber((s==null?void 0:s.transaction_value)??0)),1)):_("",!0),e.type_transaction==="history"?(o(),c("div",be,"+"+r(n.formatnumber((s==null?void 0:s.transaction_value)??0)),1)):_("",!0),t("div",we,[t("img",{src:n.img("icon_point.svg"),alt:""},null,8,ke),De])]),e.type_transaction==="payment"?(o(),c("div",Me,[(s==null?void 0:s.type_payment)==="package"?(o(),c("div",Pe,"Mua gói : "+r(s==null?void 0:s.name_package),1)):_("",!0),(s==null?void 0:s.type_payment)==="subtitle"?(o(),c("div",Te,"Mua tách phụ đề")):_("",!0),(s==null?void 0:s.type_payment)==="voice"?(o(),c("div",Ce,"Mua ký tự lồng tiếng")):_("",!0)])):_("",!0),e.type_transaction==="payment"?(o(),c("div",Ye,[s!=null&&s.number_minutes_subtitle?(o(),c("div",Be,"Tách phụ đề: "+r(n.formatnumber((s==null?void 0:s.number_minutes_subtitle)??0))+" phút",1)):_("",!0),s!=null&&s.number_voice_characters?(o(),c("div",He,"Lồng tiếng: "+r(n.formatnumber((s==null?void 0:s.number_voice_characters)??0))+" ký tự",1)):_("",!0)])):_("",!0),e.type_transaction==="history"?(o(),c("div",Se,r(s==null?void 0:s.name_agency),1)):_("",!0),t("div",Re,[s.status==="success"?(o(),c("div",ze,"Thành công")):_("",!0)])]))),128)),e.type_transaction==="payment"?tt((o(),c("div",Ie,null,512)),[[m,n.loadMorePayment]]):_("",!0)])])])):_("",!0)])]),e.isConfirmDeleteDevice?(o(),c("div",Ae,[t("div",Ee,[t("div",null,[t("img",{src:n.img("icon_warning_device.svg"),alt:""},null,8,Le)]),je,Oe,t("div",{class:"button-delete mgt-30 fw-600",style:{width:"100%"},onClick:a[9]||(a[9]=(...s)=>n.deleteDevice&&n.deleteDevice(...s))},"Xoá thiết bị")])])):_("",!0)])}typeof U=="function"&&U(W);const Ge=X(W,[["render",Ve],["__scopeId","data-v-2525f5c5"]]);export{Ge as default};
